(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[531],{51:function(e,t,a){Promise.resolve().then(a.bind(a,1385))},1385:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var s=a(3827),n=a(4090),i=a(7907),r=a(4504),l=a(1348);let o=(0,a(7688).eI)("https://oosfxoyookeouemxdejz.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vc2Z4b3lvb2tlb3VlbXhkZWp6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNzE2MDIsImV4cCI6MjA4Njg0NzYwMn0.1KDJGEr5HVWbF3W-8N_FBHBhf-57S2j3SLRhoMXqCd8");var d=a(5275),c=a(449);function m(e){let{target:t,duration:a=2,decimals:i=2,prefix:l="",onComplete:o}=e,[d,c]=(0,n.useState)(0),[m,u]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let e=Date.now(),s=1e3*a,n=()=>{let a=Math.min((Date.now()-e)/s,1);c((1-Math.pow(1-a,3))*t),a<1?requestAnimationFrame(n):(c(t),u(!0),null==o||o())};requestAnimationFrame(n)},[t,a,o]),(0,s.jsxs)(r.E.span,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"font-mono text-gold tabular-nums ".concat(m?"text-gold-light":""),children:[l,d.toFixed(i)]})}let u=["#D4AF37","#E8D48B","#B8960C","#F0E68C","#DAA520","#FFD700","#C5A028"];function x(e){let{active:t}=e,[a,i]=(0,n.useState)([]);return((0,n.useEffect)(()=>{if(!t)return;let e=[];for(let t=0;t<80;t++)e.push({id:t,x:100*Math.random(),delay:.5*Math.random(),duration:2*Math.random()+2,size:8*Math.random()+4,rotation:360*Math.random(),color:u[Math.floor(Math.random()*u.length)]});i(e)},[t]),t)?(0,s.jsx)("div",{className:"fixed inset-0 pointer-events-none z-50 overflow-hidden",children:a.map(e=>(0,s.jsx)(r.E.div,{className:"absolute",style:{left:"".concat(e.x,"%"),top:-20,width:e.size,height:.6*e.size,backgroundColor:e.color,borderRadius:"1px"},initial:{y:-20,rotate:0,opacity:1},animate:{y:window.innerHeight+50,rotate:e.rotation+720,opacity:[1,1,.8,0]},transition:{duration:e.duration,delay:e.delay,ease:"easeIn"}},e.id))}):null}function h(e){let{players:t}=e,[a,i]=(0,n.useState)("dark"),[o,d]=(0,n.useState)(0),[c,u]=(0,n.useState)(!1),[h,p]=(0,n.useState)(!1),[f,b]=(0,n.useState)(!1),[g,y]=(0,n.useState)(!1),j=t.map(e=>e.number),N=j.reduce((e,t)=>e+t,0)/j.length,v=2/3*N,w=(0,n.useCallback)(()=>{let e=1/0;return t.forEach(t=>{let a=Math.abs(t.number-v);a<e&&(e=a)}),t.filter(t=>Math.abs(t.number-v)===e)},[t,v])();(0,n.useEffect)(()=>{let e=setTimeout(()=>i("players"),1e3);return()=>clearTimeout(e)},[]),(0,n.useEffect)(()=>{if("players"===a){if(o<t.length){let e=setTimeout(()=>d(e=>e+1),400);return()=>clearTimeout(e)}{let e=setTimeout(()=>i("pause"),500);return()=>clearTimeout(e)}}},[a,o,t.length]),(0,n.useEffect)(()=>{if("pause"!==a)return;let e=setTimeout(()=>{i("average"),u(!0)},1500);return()=>clearTimeout(e)},[a]);let E=(0,n.useCallback)(()=>{setTimeout(()=>{i("twoThirds"),p(!0)},1e3)},[]),S=(0,n.useCallback)(()=>{setTimeout(()=>{i("winner"),b(!0),setTimeout(()=>y(!0),500)},1200)},[]);return(0,s.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-center px-4 py-8 relative",children:[(0,s.jsx)(x,{active:g}),(0,s.jsx)(r.E.div,{className:"absolute inset-0 bg-gradient-radial from-gold/5 via-transparent to-transparent",initial:{opacity:0},animate:{opacity:1},transition:{duration:2},style:{background:"radial-gradient(ellipse at center, rgba(212,175,55,0.08) 0%, transparent 70%)"}}),(0,s.jsxs)("div",{className:"relative z-10 w-full max-w-3xl mx-auto",children:[(0,s.jsx)(l.M,{mode:"wait",children:"dark"===a&&(0,s.jsx)(r.E.div,{className:"flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,s.jsx)("div",{className:"w-4 h-4 rounded-full bg-gold animate-gold-pulse"})},"dark")}),"dark"!==a&&(0,s.jsxs)(r.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},children:[(0,s.jsx)("h2",{className:"text-center font-serif text-2xl md:text-3xl text-gold mb-8",children:"The Numbers Are Revealed"}),(0,s.jsx)("div",{className:"flex flex-wrap justify-center gap-3 mb-10",children:t.map((e,t)=>(0,s.jsxs)(r.E.div,{initial:{opacity:0,rotateY:180},animate:t<o?{opacity:1,rotateY:0}:{opacity:0,rotateY:180},transition:{duration:.6,ease:"easeOut"},className:"border rounded-lg p-4 text-center transition-all duration-500 w-36 sm:w-40 ".concat(f&&w.some(t=>t.id===e.id)?"border-gold bg-gold/20 shadow-[0_0_30px_rgba(212,175,55,0.4)]":"border-gold/20 bg-masquerade-card"),children:[(0,s.jsx)("p",{className:"text-sm text-gold/70 font-sans truncate",children:e.name}),(0,s.jsx)("p",{className:"text-2xl font-serif text-white mt-1",children:e.number})]},e.id))}),c&&(0,s.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center mb-6",children:[(0,s.jsx)("p",{className:"text-lg text-gold/60 font-sans mb-2",children:"Average"}),(0,s.jsx)("p",{className:"text-4xl md:text-5xl font-serif",children:(0,s.jsx)(m,{target:N,duration:2,onComplete:E})})]}),h&&(0,s.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center mb-10",children:[(0,s.jsx)("p",{className:"text-lg text-gold/60 font-sans mb-2",children:"Two-Thirds of Average"}),(0,s.jsx)("p",{className:"text-4xl md:text-5xl font-serif",children:(0,s.jsx)(m,{target:v,duration:2,onComplete:S})})]}),f&&(0,s.jsxs)(r.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.8,ease:[.16,1,.3,1]},className:"text-center",children:[(0,s.jsx)(r.E.p,{className:"text-xl text-gold/80 font-serif italic mb-4",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:"The Envelope Chooses..."}),w.map(e=>(0,s.jsxs)(r.E.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},transition:{delay:.6,duration:.8,ease:[.16,1,.3,1]},className:"mb-4",children:[(0,s.jsx)(r.E.h3,{className:"text-4xl md:text-6xl font-serif text-gold font-bold",animate:{textShadow:["0 0 20px rgba(212,175,55,0.5)","0 0 40px rgba(212,175,55,0.8)","0 0 20px rgba(212,175,55,0.5)"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.name}),(0,s.jsxs)("p",{className:"text-xl text-white/80 mt-2 font-sans",children:["Chose"," ",(0,s.jsx)("span",{className:"text-gold font-bold",children:e.number})]}),(0,s.jsxs)("p",{className:"text-sm text-gold/50 mt-1 font-sans",children:["Distance from target:"," ",Math.abs(e.number-v).toFixed(2)]})]},e.id)),w.length>1&&(0,s.jsx)(r.E.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1.2},className:"text-gold/60 text-sm font-sans mt-2",children:"A rare tie — multiple victors emerge from the masquerade."})]})]})]})]})}function p(){let e=(0,i.useParams)().code.toUpperCase(),[t,a]=(0,n.useState)(null),[m,u]=(0,n.useState)([]),[x,p]=(0,n.useState)(!1),[f,b]=(0,n.useState)(""),[g,y]=(0,n.useState)(""),[j,N]=(0,n.useState)(!1),[v,w]=(0,n.useState)(!1),[E,S]=(0,n.useState)(!1),[M,C]=(0,n.useState)(""),[k,I]=(0,n.useState)(!1),[T,_]=(0,n.useState)(!0),q=(0,n.useCallback)(async()=>{let t=await (0,d.Gi)(e);t&&(a(t.room),u(t.players)),_(!1)},[e]);(0,n.useEffect)(()=>{let t=sessionStorage.getItem("host_".concat(e));t&&(p(!0),b(t));let a=sessionStorage.getItem("player_".concat(e));a&&y(a),q()},[e,q]),(0,n.useEffect)(()=>{if(!t)return;let e=o.channel("room-".concat(t.id)).on("postgres_changes",{event:"*",schema:"public",table:"players",filter:"room_id=eq.".concat(t.id)},()=>{q()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"rooms",filter:"id=eq.".concat(t.id)},e=>{a(e.new)}).subscribe();return()=>{o.removeChannel(e)}},[null==t?void 0:t.id,q]),(0,n.useEffect)(()=>{if(g&&m.length>0){let e=m.find(e=>e.id===g);e&&null!==e.number&&N(!0)}},[g,m]),(0,n.useEffect)(()=>{let t=new URLSearchParams(window.location.search),a=t.get("playerId"),s=t.get("number");if(a&&s&&!j){let t=parseInt(s,10);t>=1&&t<=100&&(y(a),(0,d.it)(a,t).then(e=>{e.success&&(N(!0),q())})),window.history.replaceState({},"","/room/".concat(e))}},[e,j,q]);let z=async()=>{try{await navigator.clipboard.writeText(e),I(!0),setTimeout(()=>I(!1),2e3)}catch(e){I(!1)}},F=async()=>{S(!0),C("");let t=await (0,d.jJ)(e,f);t.success?q():(C(t.error||"Failed to reveal"),S(!1))};if(T)return(0,s.jsx)("main",{className:"min-h-screen flex items-center justify-center bg-masquerade-bg",children:(0,s.jsx)("div",{className:"w-6 h-6 border-2 border-gold/40 border-t-gold rounded-full animate-spin"})});if(!t)return(0,s.jsxs)("main",{className:"min-h-screen flex flex-col items-center justify-center bg-masquerade-bg px-4",children:[(0,s.jsx)("h1",{className:"font-serif text-2xl text-gold mb-4",children:"Room Not Found"}),(0,s.jsx)("p",{className:"text-white/40 font-sans text-sm",children:"This room does not exist or has expired."})]});let A=async()=>{x&&(await (0,d.BM)(e,f)).success&&(sessionStorage.removeItem("player_".concat(e)),y(""),N(!1),q())};if("revealed"===t.status&&m.every(e=>null!==e.number)&&m.length>=3)return(0,s.jsxs)("main",{className:"min-h-screen bg-masquerade-bg relative",children:[(0,s.jsx)(c.Z,{count:20}),(0,s.jsx)(h,{players:m}),x&&(0,s.jsx)("div",{className:"fixed bottom-8 left-0 right-0 flex justify-center z-50",children:(0,s.jsx)(r.E.button,{onClick:A,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:8,duration:.6},className:"px-8 py-3 bg-masquerade-card border border-gold/50 text-gold font-sans text-sm rounded-sm transition-all duration-300 hover:bg-gold/10 hover:shadow-[0_0_20px_rgba(212,175,55,0.3)]",children:"Restart Masquerade"})})]});let D=m.length>=3&&m.every(e=>null!==e.number),J=m.filter(e=>null!==e.number).length;return(0,s.jsxs)("main",{className:"relative min-h-screen flex flex-col items-center justify-center px-4 py-8",children:[(0,s.jsx)(c.Z,{count:25}),(0,s.jsx)("div",{className:"absolute inset-0 z-0",style:{background:"radial-gradient(ellipse at center, rgba(212,175,55,0.04) 0%, transparent 60%)"}}),(0,s.jsxs)(r.E.div,{className:"relative z-10 w-full max-w-lg",initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8},children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("h1",{className:"font-serif text-2xl md:text-3xl text-gold mb-2",children:"The Masquerade Awaits"}),(0,s.jsx)("p",{className:"text-white/40 font-sans text-sm",children:"Share the room code with your players"})]}),(0,s.jsxs)("div",{className:"bg-masquerade-card border border-gold/20 rounded-sm p-6 mb-6",children:[(0,s.jsx)("p",{className:"text-gold/60 text-xs font-sans uppercase tracking-wider mb-3 text-center",children:"Room Code"}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,s.jsx)("span",{className:"text-3xl md:text-4xl font-mono text-gold tracking-[0.4em] font-bold",children:e}),(0,s.jsx)("button",{onClick:z,className:"px-3 py-1.5 text-xs border border-gold/30 text-gold/70 rounded-sm hover:bg-gold/10 transition-all font-sans",children:k?"Copied!":"Copy"})]})]}),(0,s.jsxs)("div",{className:"bg-masquerade-card border border-gold/20 rounded-sm p-6 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("p",{className:"text-gold/60 text-xs font-sans uppercase tracking-wider",children:["Players (",m.length,")"]}),(0,s.jsxs)("p",{className:"text-gold/40 text-xs font-sans",children:[J,"/",m.length," submitted"]})]}),(0,s.jsx)(l.M,{children:0===m.length?(0,s.jsx)("p",{className:"text-white/30 text-sm font-sans text-center py-4",children:"Waiting for players to join..."}):(0,s.jsx)("div",{className:"space-y-2",children:m.map((e,t)=>(0,s.jsxs)(r.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*t},className:"flex items-center justify-between py-2 px-3 rounded bg-masquerade-bg/50",children:[(0,s.jsx)("span",{className:"text-white/80 font-sans text-sm",children:e.name}),(0,s.jsx)("span",{className:"text-xs font-sans",children:null!==e.number?(0,s.jsx)("span",{className:"text-green-400/70",children:"✓ Submitted"}):(0,s.jsx)("span",{className:"text-gold/30",children:"Waiting..."})})]},e.id))})})]}),!x&&!g&&(0,s.jsx)("div",{className:"bg-masquerade-card border border-gold/20 rounded-sm p-6 mb-6 text-center",children:(0,s.jsxs)("p",{className:"text-white/50 font-sans text-sm",children:["You are viewing this room. To play, join from the"," ",(0,s.jsx)("a",{href:"/join",className:"text-gold underline underline-offset-2",children:"Join page"}),"."]})}),g&&!j&&(0,s.jsxs)("div",{className:"bg-masquerade-card border border-gold/20 rounded-sm p-6 mb-6 text-center",children:[(0,s.jsx)("div",{className:"w-5 h-5 border-2 border-gold/40 border-t-gold rounded-full animate-spin mx-auto mb-3"}),(0,s.jsx)("p",{className:"text-gold/60 font-sans text-sm",children:"Submitting your number..."})]}),g&&j&&(0,s.jsxs)(r.E.div,{initial:{opacity:0},animate:{opacity:1},className:"bg-masquerade-card border border-gold/20 rounded-sm p-6 mb-6 text-center",children:[(0,s.jsx)("p",{className:"text-gold font-sans text-sm",children:"✓ Your number has been submitted"}),(0,s.jsx)("p",{className:"text-white/30 text-xs font-sans mt-2",children:"Waiting for the host to reveal results..."})]}),M&&(0,s.jsx)(r.E.p,{initial:{opacity:0},animate:{opacity:1},className:"text-red-400 text-sm font-sans text-center mb-4",children:M}),x&&(0,s.jsx)(r.E.button,{onClick:F,disabled:!D||E,className:"w-full px-8 py-4 bg-transparent border border-gold text-gold font-sans font-medium text-base rounded-sm transition-all duration-300 hover:bg-gold/10 hover:shadow-[0_0_30px_rgba(212,175,55,0.3)] disabled:opacity-30 disabled:cursor-not-allowed disabled:hover:bg-transparent disabled:hover:shadow-none",whileTap:D?{scale:.98}:void 0,children:E?(0,s.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,s.jsx)("span",{className:"w-4 h-4 border-2 border-gold/40 border-t-gold rounded-full animate-spin"}),"Revealing..."]}):D?"Reveal Results":"Waiting for submissions (".concat(J,"/").concat(m.length,")").concat(m.length<3?" — Need 3+ players":"")}),x&&m.length<3&&(0,s.jsx)("p",{className:"text-gold/30 text-xs font-sans text-center mt-3",children:"Minimum 3 players required to begin"})]})]})}},449:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(3827),n=a(4090),i=a(4504);function r(e){let{count:t=40}=e,[a,r]=(0,n.useState)([]);return(0,n.useEffect)(()=>{let e=[];for(let a=0;a<t;a++)e.push({id:a,x:100*Math.random(),y:100*Math.random(),size:3*Math.random()+1,duration:8*Math.random()+6,delay:5*Math.random(),opacity:.5*Math.random()+.1});r(e)},[t]),(0,s.jsx)("div",{className:"fixed inset-0 pointer-events-none overflow-hidden z-0",children:a.map(e=>(0,s.jsx)(i.E.div,{className:"absolute rounded-full",style:{left:"".concat(e.x,"%"),top:"".concat(e.y,"%"),width:e.size,height:e.size,backgroundColor:"#D4AF37"},animate:{y:[0,-30,0],x:[0,20*Math.random()-10,0],opacity:[e.opacity,1.5*e.opacity,e.opacity]},transition:{duration:e.duration,delay:e.delay,repeat:1/0,ease:"easeInOut"}},e.id))})}},5275:function(e,t,a){"use strict";a.d(t,{BM:function(){return d},Gi:function(){return n},Ls:function(){return r},dB:function(){return i},it:function(){return l},jJ:function(){return o}}),a(5355);var s=a(3472),n=(0,s.$)("f972cc93aaa8e5e619e1da89ffcb6130f9d9a302"),i=(0,s.$)("7a9d60296671b80f99ee80e54f5ceb4695f3bd09"),r=(0,s.$)("08e9cf0c01117b3e4e143dc5715de55c768d93d7"),l=(0,s.$)("0036fe03d9fd9a23536c862ebf094439a01b91c2"),o=(0,s.$)("6533112c9a26bbd6e38efa2ebcd06f7fce005398"),d=(0,s.$)("073ce1767dcee64b2fc630df8e98e642631d3a29")}},function(e){e.O(0,[504,793,971,69,744],function(){return e(e.s=51)}),_N_E=e.O()}]);